{% extends 'base.html.twig' %}

{% block title %}Panier{% endblock %}

{% block body %}
      <h4 class="text-center p-3">Récapitulatif de votre panier</h4>

        <table class="table_panier">
            <thead>
                <tr class="text-primary">
                    <th>Image du produit</th>
                    <th>Produit</th>
                    <th>Prix(unité)</th>
                    <th>Quantité</th>
                    <th>Montant</th>
                    <th>Supprimer</th>
                </tr>
            </thead>

            <tbody>

                {# on créé un compteur qui permettra de calculer le montant du panier #}
                {% set montantTotal = 0 %}
                {% for lignecommande in panier.lignecommandes %}

                    {# on affiche les propriétés désirées #}
                        <tr>{# on affiche l'image du produit#}
                            <td class="image">
                                <img src="{{ asset('/products/' ~  lignecommande.product.featuredImage )}}" 
                                alt="image du produit" width="60">
                            </td>
                            <td>{{ lignecommande.product.title }}</td>
                            <td>{{  lignecommande.product.price / 100 }} €</td>
                                {# en TWIG il est possible de multiplier, additionner, soustraire ou diviser les    propriétés     entre   elles si leur type s'y prète (integer ou float) #}
                            <td>{# recupérer la  quantité dans une ligne de commande #}
                                {{ lignecommande.quantite }}
                            </td>
                            <td>{{ lignecommande.quantite * lignecommande.product.price / 100 }} € </td>

                                {# formulaire pour supprimer une ligne de commande 
                                 {{ include('lignecommande/_delete_form.html.twig') }}#}
                             <td><form method="post"  
                                     action="{{ path('home-lignecommande_delete',{'id': lignecommande.id}) }}" 
                                    onsubmit="return confirm('Souhaitez-vous retirer ce produit de votre panier?');">
                                    <input type="hidden" name="_token"  
                                    value="{{ csrf_token('delete' ~  lignecommande.id) }}"><button class="btn btn-outline-danger"><i class="bi bi-x-square"></i></button> 
                                 </form>         
                             </td> 
                                {# à chaque tour de boucle, càd pour chaque ligne de commande, on incrémente le compteur    avec le montant de cette ligne #}
                                {% set montantTotal = montantTotal + (lignecommande.quantite * lignecommande.product.price) / 100 %}
                        </tr>
       


       

                    <td colspan="4">Total des produits dans le panier</td>
                  {#   <td>{% if lignecommande.quantite|length > 1 %} #}
                  {#       {{lignecommande.quantite}}</td> #}
                  {#       {% endif %} #}
     {% endfor %}
    </tbody>
                    <td colspan="4">Total du panier</td>
                    {# maintenant on peut afficher le compteur qui contient le montant total, on pourrait aussi lui appliquer un traitement pour une remise ou calculer la tva... #}
                    <td>{{ montantTotal }} €</td>
                
                 
            
        </table>

                {# formulaire pour supprimer ou vider le panier #}
        <p class="text-end"><a href="{{ path('home-product') }}">Vider le panier</a></p>
            {# <form method="post" action="{{ path('panier_delete', {'id': panier.id}) }}" #}
            {#     onsubmit="return confirm('Are you sure you want to delete this product?');"> #}
            {#     <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ panier.id) }}"> #}
            {#     <button class="btn btn-outline-danger">Supprimer le panier</button> #}
            {# </form> #}
            

    <div>
        <h6 class="ms-2">Choisir le mode de livraison</h6>
        {# Formulaire pour afficher le choix de livraison#}
        
         {#  {{ form_start(formLivraison) }}    #}
         {#      {{ form_widget(formLivraison) }}    #}
         {#  {{ form_end(formLivraison) }}    #}
        <input type="radio" id="form_modeLivraison" name="form[modeLivraison]" required="required" value=""/>
        <label for="domicile"> Domicile</label><br>

        {# affichage de l'addresse du client #}
            <p class="ms-2">{{ app.user.address}}<br>
            {{ app.user.zipCode}}<br>
            {{ app.user.city}}</p>

             {# Formulaire pour Ajouter une nouvelle adresse #}
                {# {{ form_start(formAd) }}   #}
                {#     {{ form_widget(formAd) }}  #}
                {# {{ form_end(formAd) }}  #}
    </div>

    <div>
        <h6>Choisir mode de paiement</h6>
        <form  class="mt-3" action="{{ path ('home-panier_validation')}}">
  
     <input type="radio" name="card" id="card"/>
     <label for="card">Carte bancaire</label>
   
     <input type="radio" name="domicile" id="domicile"/>
     <label for="paypal"> Paypal</label>
</form>
    </div>

 {# formulaire pour payer la commande et envoyé dans la base de données #}
 {{ form_start(form) }}  
   {{ form_widget(form) }} 
  {{ form_end(form) }} 
{% endblock %}
